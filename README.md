# Dark Sun Campaign Assistant

An AI-powered campaign assistant for Dark Sun D&D campaigns, featuring integration with MCP (Model Context Protocol) servers for Obsidian notes, Foundry VTT, and local filesystem access.

## Current Status: ✅ Tested & Working

**Last Tested:** October 5, 2025  
**Status:** Core functionality working, configuration required for full features

### ✅ What's Working:
- ✅ Server builds and starts successfully
- ✅ Web-based UI with modern chat interface
- ✅ REST API for conversations and chat
- ✅ In-memory conversation storage (CRUD operations)
- ✅ Health check endpoint with MCP status
- ✅ MCP client framework configured for 3 servers
- ✅ Frontend TypeScript compiled to ES modules
- ✅ Foundry VTT server accessible and running

### ⚠️ Configuration Required:
- ⚠️ Anthropic API key (for Claude AI chat)
- ⚠️ SSH key authentication (for Foundry MCP access)
- ⚠️ Foundry MCP Bridge module (for Foundry integration)

**See [QUICK_SETUP.md](QUICK_SETUP.md) for 30-minute setup guide**  
**See [TEST_REPORT.md](TEST_REPORT.md) for detailed test results**

## Prerequisites

- Node.js 24.x or later
- npm (comes with Node.js)

## Quick Start

### 1. Installation

```bash
cd ~/Documents/GitHub/dark-sun-assistant
npm install
```

### 2. Build

```bash
npm run build
```

This compiles both the backend TypeScript (`src/`) and frontend TypeScript (`frontend/`) to JavaScript.

### 3. Start Server

```bash
npm start
```

The server will start on port 3000 (configurable via PORT environment variable).

### 4. Access the Application

Open your browser to:
- **Main UI**: http://localhost:3000
- **Health Check**: http://localhost:3000/api/health

## Project Structure

```
dark-sun-assistant/
├── src/                    # Backend source files (TypeScript)
│   ├── server.ts          # Express server and main entry point
│   ├── mcp-client.ts      # MCP client manager
│   ├── storage.ts         # In-memory conversation storage
│   ├── types.ts           # TypeScript type definitions
│   └── routes/
│       └── api.ts         # API route handlers
├── frontend/              # Frontend source files (TypeScript)
│   └── app.ts            # Main frontend application
├── public/               # Static files served by Express
│   ├── index.html       # Main UI
│   ├── css/
│   │   └── style.css    # Application styles
│   └── js/              # Compiled frontend JavaScript
│       └── app.js       # (generated by build)
├── dist/                # Compiled backend JavaScript (generated by build)
├── package.json         # Project dependencies and scripts
├── tsconfig.json        # TypeScript config for backend
└── tsconfig.frontend.json  # TypeScript config for frontend
```

## Available Scripts

- `npm run build` - Compile TypeScript to JavaScript
- `npm start` - Start the server (requires build first)
- `npm run dev` - Build and start in one command
- `npm run clean` - Remove compiled files
- `npm run rebuild` - Clean and rebuild

## API Endpoints

### Health Check
```bash
GET /api/health
```

Returns server status and MCP server connection status.

### Chat
```bash
POST /api/chat
Content-Type: application/json

{
  "message": "Your message here",
  "conversationId": "optional-conversation-id"
}
```

Sends a message and receives a response. Creates a new conversation if no ID is provided.

### Get All Conversations
```bash
GET /api/conversations
```

Returns all conversations with their messages.

### Get Specific Conversation
```bash
GET /api/conversations/:id
```

Returns a specific conversation by ID.

### Create Conversation
```bash
POST /api/conversations
Content-Type: application/json

{
  "title": "Optional conversation title"
}
```

Creates a new empty conversation.

### Delete Conversation
```bash
DELETE /api/conversations/:id
```

Deletes a specific conversation.

## Current Limitations (MVP Stage)

1. **In-Memory Storage**: Conversations are stored in memory and will be lost when the server restarts. For persistent storage, SQLite integration is planned but requires Node.js/C++ compatibility fixes.

2. **Mock Responses**: The chat endpoint returns placeholder responses. To enable actual AI functionality, you need to:
   - Configure Claude API integration
   - Set up MCP servers (see SETUP_REQUIRED.md)

3. **No Authentication**: The current version has no user authentication or session management.

## Next Steps

See **SETUP_REQUIRED.md** for detailed instructions on:
- Configuring MCP servers for Obsidian, Foundry VTT, and filesystem access
- Adding Claude API integration
- Configuring persistent database storage

## Development

### TypeScript Configuration

The project uses two TypeScript configurations:
- `tsconfig.json` - For backend code (Node.js, CommonJS)
- `tsconfig.frontend.json` - For frontend code (Browser, ES modules)

### Hot Reload Development

For development with automatic recompilation, you can use:

```bash
# Terminal 1 - Watch backend changes
npx tsc --watch

# Terminal 2 - Watch frontend changes
npx tsc -p tsconfig.frontend.json --watch

# Terminal 3 - Run server (restart manually after changes)
npm start
```

Or use a tool like `nodemon` for automatic server restarts.

## Environment Variables

- `PORT` - Server port (default: 3000)

## Troubleshooting

### Server won't start
- Make sure you've run `npm run build` first
- Check that port 3000 is not already in use
- Check `npm install` completed successfully

### Build errors
- Ensure TypeScript is installed: `npm install`
- Check Node.js version: `node --version` (should be 20.x or later)

### Dependencies fail to install
- Some native dependencies (like better-sqlite3) may have compatibility issues with Node.js 24.x
- For MVP, the project uses in-memory storage to avoid these issues
- Check SETUP_REQUIRED.md for alternative solutions

## License

MIT
